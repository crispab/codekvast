buildscript {
    repositories { maven { url "https://maven.eveoh.nl/content/repositories/releases" } }
    dependencies { classpath "nl.eveoh:gradle-aspectj:1.4" }
}

apply plugin: 'aspectj'
apply plugin: 'shadow'

description = "The javaagent part of Duck agent"
archivesBaseName = "duck-agent-sensor"
version = project.parent.parent.version
sourceCompatibility = 1.6

dependencies {
    compile project(":product:agent:util"), { transitive = false }
    compile libs['aspectjweaver']

    // Absolutely NO other compile or runtime dependencies are allowed here!
    // All (transitive) compile and runtime dependencies will end up in the sensored app's system
    // class path, which is unacceptable.
}

jar { manifest { attributes("Premain-Class": "se.crisp.duck.agent.sensor.DuckSensor") } }

shadow {
    outputFile = file("$buildDir/distributions/duck-sensor-${version}.jar")
}

// Make a shadow jar consisting of duck-agent-sensor and it's dependencies...
assemble.dependsOn shadowJar
