apply plugin: 'org.unbroken-dome.test-sets'

testSets {
  integrationTest
}
check.dependsOn integrationTest

dependencies {
  integrationTestImplementation "com.github.tomakehurst:wiremock-standalone:$wiremockVersion"
  integrationTestImplementation "org.springframework.boot:spring-boot-starter-aop:$springBootVersion"
  integrationTestImplementation testFrameworks
  integrationTestRuntimeOnly aspectjWeaver
  integrationTestRuntimeOnly logback
}

integrationTest {
  dependsOn verifyShadowJar
  shouldRunAfter test
  useJUnitPlatform()

  inputs.files file("build.gradle")
  inputs.files shadowJar.outputs.files
  inputs.files sourceSets.integrationTest.output
  outputs.dir file("$buildDir/test-results/integrationTest")

  systemProperty 'integrationTest.codekvastAgent', shadowJar.outputs.files.asPath
  systemProperty 'integrationTest.jacocoAgent', "${configurations.jacocoagent.asPath}=destfile=${buildDir}/jacoco/integrationTest2.exec,output=file,dumponexit=true"
  systemProperty 'integrationTest.classpath', "build/classes/java/integrationTest:${configurations.integrationTestRuntimeClasspath.asPath}"
  systemProperty 'integrationTest.javaVersions', """
        ${sdkmanJavaVersion_8},
        ${sdkmanJavaVersion_9},
        ${sdkmanJavaVersion_10},
        ${sdkmanJavaVersion_11},
        ${sdkmanJavaVersion_12},
        ${sdkmanJavaVersion_13},
        ${sdkmanJavaVersion_14},
        ${sdkmanJavaVersion_15},
        ${sdkmanJavaVersion_16},
        ${sdkmanJavaVersion_17}
        """
}


