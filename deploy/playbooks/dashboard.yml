---
#--------------------------------------------------------------------------------------------------------------------------------
# Playbook that installs the Codekvast Dashboard application, which is an executable Spring Boot jar running as a systemd service
#--------------------------------------------------------------------------------------------------------------------------------
- name: Codekvast Dashboard Application
  hosts: tag_role_backend

  become: yes
  serial: 1

  vars_files:
  - vars/secrets.yml
  - vars/common.yml

  vars:
    server_type: application
    service_name: dashboard
    service_port: "{{ ports.dashboard.service }}"
    management_port: "{{ ports.dashboard.management }}"
    fileImportQueuePath: "/var/codekvast/dashboard/queue"

  roles:
  - {role: Datadog.datadog, tags: [metrics,monitoring,datadog] }
  - {role: codekvast.datadog, tags: [metrics,monitoring,datadog] }
  - {role: codekvast.common, tags: [common]}
  - {role: Comcast.sdkman, tags: [common]}
  - {role: codekvast.spring-boot-service, tags: [service, dashboard]}

  post_tasks:
  - name: Create directories
    file: path={{ item }} state=directory owner=codekvast group=codekvast
    with_items:
    - "{{ fileImportQueuePath }}"
